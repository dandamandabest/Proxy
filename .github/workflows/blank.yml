name: Sync Proxies Folder

on:
  workflow_dispatch:
  schedule:
    - cron: '0 * * * *'  # Her saat başı çalıştırır

jobs:
  sync_proxies:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout current repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  

      - name: Configure Git
        run: |
          git config --global user.name "handeveloper1"
          git config --global user.email "oguzhanyazman@gmail.com"

      - name: Remove old proxies folders (if exist)
        run: |
          rm -rf "Proxies-Ercin" "Proxy-hendrikbgr"

      - name: Clone only proxies folder
        run: |
          git clone --depth=1 https://github.com/ErcinDedeoglu/proxies.git temp_repo
          mkdir -p "Proxies-Ercin"
          mv temp_repo/proxies/*.txt "Proxies-Ercin"
          rm -rf temp_repo 

      - name: Download proxy_list.txt from hendrikbgr repo
        run: |
          mkdir -p "Proxy-hendrikbgr"
          curl -o "Proxy-hendrikbgr/proxy_list.txt" -L "https://raw.githubusercontent.com/hendrikbgr/Free-Proxy-Repo/master/proxy_list.txt"

      - name: Append update timestamp to README.md
        run: |
          echo "\nLast updated: $(date --utc +'%Y-%m-%d %H:%M:%SZ')" >> README.md

      - name: Pull latest changes and push
        run: |
          git add "Proxies-Ercin" "Proxy-hendrikbgr" README.md
          if git diff --cached --quiet; then
            echo "No changes to commit."
            exit 0
          fi
          git commit -m "Updated proxies and timestamp in README.md"
          git pull --rebase origin main || git rebase --skip
          git push origin main
